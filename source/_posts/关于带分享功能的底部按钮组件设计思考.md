---
title: 关于带分享功能的底部按钮组件设计思考
date: 2017-09-27
---

<!-- 为了更方便归档，请先完善以上信息，正文贴下面 -->
<!--
注意点：
0. 文章中的资源（主要是图片）引用请使用 HTTPS
1. 文章末可以加上自己的署名，如： by [Kaola](http://www.kaola.com)
2. 最好不要用 NOS 图床，感觉加防盗链是迟早的事
3. 文章会定期归档到 https://blog.kaolafed.com/
-->
## 需求
![sharebtn.png](https://haitao.nos.netease.com/78d05138-a810-441f-9fae-3312ebfcb118.png)


## 目录结构
![目录结构.jpg](https://haitao.nos.netease.com/4bd22c0f-99fd-4c0e-86c0-d6d17af3efd5.jpg)

## 关于底部分享按钮的设计
### 起初设计
```javascript
  <div on-click={this.openShare()}>立即邀请 共享黑卡时刻</div>
  <share></share>
```

```javascript
// share 组件
{#if isBrowser}
  <browser></browser>
{#else}
  <wxappshare></wxappshare>
{/if}
```

&emsp;&emsp;原本设计思路是点击按钮——>调用share组件的openShare方法this.$refs.share.openShare() ——> 根据isBrowser 调用 browser组件的share方法或者调用wxappshare组件的share方法。这样导致设计的层级很深

### 改进设计
&emsp;&emsp;后来想到我们本质的需要就是click直接有个share组件，share组件直接会触发openShare方法

&emsp;&emsp;点击 ——> isOpenShare 为true ——> 展示share组件 ——> share组件内部判断浏览环境 ——> 展示browser或者appwxshare

&emsp;&emsp;利用if的true或者false会直接影响组件的生成与销毁，所以我们只需要把我们各环境需要的组件的share方法写在组件的init里面去触发，所以代码就变为

```javascript
// shareBtn/index.html
<section on-click="{openShare = true}">
    立即邀请  共享黑卡福利
</section>
{#if openShare}
    <share></share>
{/if}


// --------------------------------------
// widget/share/index.html其js省略
{#if isBrowser}
    <browser></browser>
{#else}
    <wxappshare></wxappshare>
{/if}


// --------------------------------------
// widget/share/index.js
/**
 * @func: 不同环境的分享组件
 */
define([
    'pro/widget/BaseComponent',
    'pro/extend/util',
    'text!./index.html',
    './browser.js',
    './appwxshare.js'
], function(BaseComponent, _, tpl, browser, wxappshare) {
    var ShareComponent = BaseComponent.extend({
        template: tpl,
        config: function(data) {
            data.isBrowser = !(_.isKaolaApp() || _.isInWeixinApp() || _.isInYixinApp());
        },
        init: function() {
        }
    })
    .component('browser', browser)
    .component('wxappshare', wxappshare);

    return ShareComponent;
});



// --------------------------------------
// widget/share/appwxshare.js 不需要tpl
/**
 * @func: 分享按钮组件
 */
define([
    'pro/widget/BaseComponent',
    'pro/widget/util/appbridge'
], function(BaseComponent, getappbridge) {
    var WxAppShareComponent = BaseComponent.extend({
        config: function(data) {
            this.supr(data);
        },
        init: function() {
            // init的时候直接调
            this.onShare();
        },
        onShare: function() {
            this.__appbridge = getappbridge();
            // openShare方法封装了1.kaolaApp里面调起分享浮层 2.微信里面弹出一个引导分享的浮层
            this.__appbridge._$openShare(window.shareConfig, function() {
                // 回调
            }._$bind(this), function() {
                // 回调
            }._$bind(this));
        }
    });

    return WxAppShareComponent;
});


// --------------------------------------
// widget/share/browser.html
<div class="n-share-browser">
    <div class="title">长按复制以下链接分享给好友吧！</div>
    <div class="link">{link||''}</div>
    <div class="b-btn btn-1" on-click={this.comfirm()}>确定</div>
</div>


// widget/share/browser.js
define([
    'text!./browser.html',
    'pro/components/modal/modal'
], function(tpl, Modal){
    var ShareModal = Modal.extend({
        content: tpl,
        config: function(data){
            this.supr(data);
            this.data.winbodyClass = 'winbody browser-share';
        },
        init: function(){
            this.supr();
        },
        comfirm: function(event){
            this.hide();
        }
    });

    return ShareModal;
});
```
## 总结
* 这样设计以后其他页面底部也有这种按钮时，复用性特别高
*  转变原先的思路，归根结底还是用数据去驱动组件