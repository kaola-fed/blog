---
title: 【译】23分钟实现更好的字体加载方案
date: 2017-12-08
---

<!-- 为了更方便归档，请先完善以上信息，正文贴下面 -->
<!--
注意点：
0. 文章中的资源（主要是图片）引用请使用 HTTPS
1. 文章末可以加上自己的署名，如： by [Kaola](http://www.kaola.com)
2. 最好不要用 NOS 图床，感觉加防盗链是迟早的事
3. 文章会定期归档到 https://blog.kaolafed.com/
-->

我在工程中搜索@font-face，然后找到了两个：8bit Art Sans和VT323。

### 我们来做下以下操作：

1. 删除所有的非TTF文件的web字体文件——我们将用自己的文件；
2. 使用[glyphhanger](https://github.com/filamentgroup/glyphhanger)来自动创建网站实际使用的字体集合（包括ASCII）：
   -     glyphhanger http://make8bitart.localhost/ --US_ASCII --subset=assets/fonts/*.ttf
   - 注意glyphhanger输出最优子集WOFF2、WOFF（[zopfli](https://zh.wikipedia.org/wiki/Zopfli)能存储更多数据）、TTF文件
3. 将@font-face代码块指定的字体文件更新为新的字体文件，并移除掉WOFF2、WOFF和TTF之外的其他所有格式文件（或许glyphhanger需要增加进行这个操作的功能）；
4. 对所有支持的浏览器添加font-display: swap;属性以减少FOUT（目前只有chrome浏览器不支持，但是相信以后会支持）;
5. 预加载web字体以使请求开始得更早一点并减少FOIT和FOUT：
   -     <link rel="preload" href="FILE_PATH.woff2" as="font" type="font/woff2" crossorigin>
6. 更新[Service Worker](https://caniuse.com/#feat=serviceworkers)、只缓存[WOFF2](https://caniuse.com/#feat=woff2)版本，因为Service Worker是WOFF2的浏览器支持子集（浏览器支持WOFF2、也必然支持Service Worker）;
7. 检查并提交代码。
![](https://haitao.nos.netease.com/2a79e3a2-670e-467f-b4b3-8de9f76ff04f.png)

### 性能
（chrome浏览器，选择Fast 3G网络环境）

我们来比较下做了以上操作之前和之后页面的加载情况

**之前**

- 字体白屏时间：773ms
- 页面大小：296 KB
- 字体文件大小（TTF和WOFF）：7.1 KB + 84.8KB = 91.1 KB
- FOIT：
  - 773ms -> 8bit Art Sans  1.91s： 结果共 1.137s
  - 773ms -> VT323  3.72s： 结果共2.947s（FOIT 窗口时间是3s、即浏览器隐藏文本3s直到字体加载完成）
- FOUT：无

**之后**

- 字体白屏时间：763ms（接近）
- 页面大小：215 KB
- 字体文件大小（WOFF2）：4.2 KB + 6.5 KB = 10.8 KB (只有原来的11%， 节省了80.3KB)
- FOIT：无（如果预加载preload没有执行，font-display就会发挥作用）
- FOUT：无（预加载preload禁止了8bit Art Sans 和 VT323）

### 总结

字体加载有时候会让人感到困惑甚至恐惧，如果你正在被字体加载问题困扰的话，以上内容能帮助你快速提高你的网站的性能，或许不能做到性能最优、但能让你的网站性能变得更好。

通过使用preload，在Fast 3G网络环境下，我们消除了FOUT和FOIT。在更慢的网络环境中，我们在浏览器中使用font-display，以消除FOIT、使浏览器显示降级字体（FOUT）。




原文：[23 MINUTES OF WORK FOR BETTER FONT LOADING](https://www.zachleat.com/web/23-minutes/?utm_source=CSS-Weekly&utm_campaign=Issue-292&utm_medium=web)




译者注：

1. FOIT：一些浏览器在加载自定义字体时，会隐藏文字，这种称之为Flash Of Invisible Text（FOIT）；
2. FOUT：一些浏览器在加载自定义字体时，会显示降级字体Flash Of Unstyled Text（FOUT）（自定义字体加载完成再显示自定义字体）；
3. 翻译过程中省略了一些无关紧要的段落。

by 宋飞翔



